  # VKAPI:
    
Frame:              completed.......

More commands:      in process......

Rest and peace:     later...........

  # INFO:

# Взаимодействие с Callback API:

Вконтакте может уведомлять сервер о любых изменениях вашей группы. Подробнее об этом можно почитать на https://vk.com/dev/callback_api , я опишу как правильно настроить сервер, чтобы он был готов принимать от вконтакте запросы. 
Для начала следует создать веб-сервер. В Visual Studio это сделать достаточно легко: 
  Нажимаем создать проект, выбираем веб-приложение (ASP.NET Core или Framework, я выбрал Core), затем вводим название и выбираем API. Можно выбрать любой из списка, но тогда в вашем проекте будет много ненужного. К примеру MVC вам создаст View (html странички). Все готово.

1) В папке Controllers можно найти CallbackController. В данном случае он нужен для того, чтобы ловить и парсить данные, которые будет посылать ВК. Парсинг происходит сразу в этом методе, но когда будет добавлено большее количество команд, его стоит перенести в отдельный метод. 
2) В методе Callbacks есть некоторая конструкция. Она требуется как раз таки для парсинга данных от ВК. Реализована она при помощи оператора switch. Туда нужно передать значение поля type из json объекта, полученного от ВК. Выглядит он примерно вот так:
    {
      "type": "group_join", 
      "object": {
          "user_id": 1,
          "join_type" : "approved"
          },
      "group_id": 1
    }
    Это придет, когда в группу кто-то присоеденится. 
    
3) Следующий шаг - добавить в парсинг какое-нибудь еще событие. К примеру можно распарсить событие описанное выше. 
        Выглядеть это должно вот так: 
        
        switch (responseObject.Value<string>("type"))
        {
            case "group_join":
                //Тут будут происходить какие-нибудь действия.
                return Ok("ok");
                //
            default:
                return Ok("ok");
        }
4) Следует обратить внимание, что закончить все ОБЯЗАТЕЛЬНО нужно return Ok("ok"); . Иначе ВК будет мучать ваш сервер пока вы не ответите.

# Теперь напишем ответ:

Бот сконструирован таким образом, чтобы из него было не сложно добавлять и удалять команды. Для этого нужно сделать несколько подготовительных действий. 
Первое что требуется - это создать новый класс который будет наследоваться от абстрактного класса Command, который будет перезаписывать метод Execute и поле Name. Метод Execute в конце должен выполнять client.SendMessage(message) (не обязательно, но если хочется чтобы бот отправил сообщение юзеру, то следует добавить). Также нужно добавить текст, который будет отправлен пользователю в поле Body класса Message. Делается это вот так: Message.Body="Ваша команда"; 
Следующим шагом следует добавить команду в List, чтобы это сделать нужно перейти в класс Commands и добавить в список метода Get new КонструкторВашегоКласса(); . Все готово! Команда успешно добавлена.

P.S. Добавить префикс (чтобы бот отзывался только если сообщение начинается с ! тоже не сложно. Просто в метод Contains абстрактного класса Command нужно изменить строчку 

    return command.Contains(Name); 
на 

    return command.Contains("!"+Name); 
    
, где "!" это ваш опозновательный знак. 


# Теперь добавим свою команду. 

1) Создаем новый класс по пути VkApi\Models\Response и добавляем туда нужные Json параметры, которые вы хотите использовать для считывания. Для group_join будет использоваться та же класс GroupJoin с полями Type, Object и Group_Id. Поля Type и GroupId являются полями типа string, а поле Object должно быть отдельным классом, который можно назвать как User. В нем должны быть поля user_id и join_type. Для примера можно посмотреть на Message.cs находящийся по тому же пути.
2) Теперь о том, как правильно заполнить case контроллера. В кейсе message_new я использую рабочий код, который наверняка подойдет, но сейчас я его распишу понятнее. 

        //Десериализуем запрос от вконтакте в нужный нам класс. 
        //В данном случае используется  выдуманный класс Test, 
        //вам нужно заменить его на класс, который вы создали во 2 пункте. 
        //В итоге получается объект класса Test и заполненные поля из json,
        //который отправил вам Callback API 
        //(Если вы все правильно сделали конечно). 
        
        var test = JsonConvert.DeserializeObject<Test>(strRequest); 
        
        //Тут перебираю каждый элемент списка и вызываю метод Contains, 
        //который содержит сообщение пользователя и проверяет есть ли в сообщении команда.
        
        var command = commands.FirstOrDefault(x => x.Contains(msg.users.Body));

        if (command == null) //проверка на нал
        {
            //Возвращаем ок если команда не найдена. 
            //То есть ничего не делаем. Это обязательно, 
            //иначе вк будет долбить сервер и будет спам от бота одинаковыми сообщениями. 
            
            return Ok("ok");                        
        }
        //Запускаем выполнение команды 
        
        command.Execute(client, new VKMessage { User_Id = msg.users.Id, Body = ""});       
        
        
3) Должно все работать! Если я ничего не забыл конечно. 
        
